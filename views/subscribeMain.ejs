<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>news</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="wrap">




    <header>
        <ul>
            <li><a href="/">전체 언론사</a></li>
            <li><a href="/main">My news</a></li>
        </ul>

        <div class="btn">
            <div class="left"><a href="#"><</a></div>
            <div class="right"><a href="#">></a></div>
        </div>
    </header>

    <section class="mainArea" id="mainArea">
            <div class="subscribeBtn">
                <table class="table table-bordered" id="subTable">
                    <tbody>
                        <% newsData.forEach((val,idx)=>{

                        if(idx % 4 !== 0  && idx !==0 ){
                            if(idx % 4 === 3){
                        %>
                             <td><div class="pressImgDiv" id="i<%=val._id%>" ><hidden class="<%=val.state%>"></hidden><img src="<%=val.pressimgurl%>"  width="100" height="100" /></div></td></tr>
                        <% }else{ %>
                            <td><div class="pressImgDiv" id="i<%=val._id%>"><hidden class="<%=val.state%>"></hidden> <img src="<%=val.pressimgurl%>"width="100" height="100"  /></div></td>
                        <% } }else{ %>
                            <tr><td><div class="pressImgDiv" id="i<%=val._id%>"><hidden class="<%=val.state%>"></hidden> <img src="<%=val.pressimgurl%>" width="100" height="100"  /></div></td>
                        <%
                        }
                        })
                        %>
                    </tbody>
                </table>
            </div>
    </section>
</div>



<script src="js/utility/utility.js"></script>

<script>
    setStateColor();

    let tbDom = utility.$selector("tbody");
    tbDom.addEventListener("click",(e)=>{
        let target = e.target;
        if(target.tagName === "IMG") {
            let div = target.parentNode;
            let _id = div.id.slice(1);
            let state = div.firstChild.className;

            if(state === '0'){
                div.style.borderColor = "red";
            }
            else{
                div.style.borderColor = "black";
            }

            utility.runAjax(reqListener,"GET",utility.defaultUrl + "/newsData/updateSubState/" + _id + "_" + state);
        }
    });

    function reqListener(data){
        let res = JSON.parse(data.currentTarget.response);
        utility.$selector("#i"+res._id  + ">hidden").setAttribute("class",res.state);

    }

    function setStateColor(){

        let hiddenDoms = document.querySelectorAll("hidden");

        hiddenDoms.forEach((val)=>{
            if(Number(val.className) === 1){
                val.parentNode.style.borderColor = "red";
            }else{
                val.parentNode.style.borderColor = "black";
            }
        })

    }

</script>

</body>
</html>
